cmake_minimum_required(VERSION 2.8.12)
project(Trojan)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11 -O2")
set(THREADS_PREFER_PTHREAD_FLAG ON)
add_executable(trojan src/clientsession.cpp src/config.cpp src/log.cpp src/main.cpp src/serversession.cpp src/service.cpp src/session.cpp src/trojanrequest.cpp src/version.cpp)
find_package(Threads REQUIRED)
target_link_libraries(trojan ${CMAKE_THREAD_LIBS_INIT})
find_package(Boost 1.54.0 REQUIRED COMPONENTS atomic chrono date_time system thread)
include_directories(${Boost_INCLUDE_DIR})
target_link_libraries(trojan ${Boost_LIBRARIES})
find_package(OpenSSL 1.0.2 REQUIRED)
include_directories(${OPENSSL_INCLUDE_DIR})
target_link_libraries(trojan ${OPENSSL_LIBRARIES})
if(WIN32)
    target_link_libraries(trojan wsock32 ws2_32)
else()
    install(TARGETS trojan DESTINATION bin)
    if(NOT EXISTS /etc/trojan.json)
        configure_file(examples/server.json-example trojan.json COPYONLY)
        install(FILES ${CMAKE_BINARY_DIR}/trojan.json DESTINATION /etc)
    endif()
    if(EXISTS /etc/systemd/system)
        configure_file(examples/trojan.service-example trojan.service)
        install(FILES ${CMAKE_BINARY_DIR}/trojan.service DESTINATION /etc/systemd/system)
    endif()
endif()
